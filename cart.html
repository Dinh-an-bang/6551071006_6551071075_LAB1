
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="cart_page_title">Gi·ªè h√†ng c·ªßa b·∫°n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../Styles/style.css"> 
    <link rel="stylesheet" href="../Styles/cart.css"> 
</head>

<body>
    <header class="navbar navbar-expand-lg sticky-top bg-body-tertiary shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                <i class="fas fa-part-reader me-2"></i>Thi·ªán D∆∞∆°ng Gear<sup>&copy;</sup>
            </a>
            <div class="d-flex align-items-center">
                <a href="cart.html" class="btn position-relative me-3">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count badge rounded-pill bg-danger position-absolute top-0 start-100 translate-middle" style="display: none;">
                        0 
                    </span>
                </a>
                
                <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <a class="nav-link" href="index.html" role="button" data-key="nav_parts">Trang ch·ªß</a>
                    <a class="nav-link" href="collection.html" role="button" data-key="nav_collections">S·∫£n Ph·∫©m</a>
                    <a class="nav-link" href="events.html" role="button" data-key="nav_news">Tin t·ª©c & S·ª± ki·ªán</a>
                    <a class="nav-link" href="contact.html" role="button" data-key="nav_about">Li√™n L·∫°c</a>
                </ul>
                <div class="d-none d-lg-flex align-items-center">
                    <div class="dropdown-container">
                        <button class="menu-toggle-button user-icon-btn" onclick="toggleMenu()">
                            <i class="fas fa-user-circle"></i>
                        </button>
                        <div class="dropdown-menu" id="userDropdown">
                            <a href="#" class="menu-header-icon">
                                <i class="fas fa-user-circle fa-4x"></i>
                            </a>
                            <div class="menu-title" data-key="user_menu_title">Ng∆∞·ªùi d√πng</div>
                            <a href="#" class="menu-item" data-key="profile">H·ªì s∆° c·ªßa t√¥i</a>
                            <a href="cart.html" class="menu-item" data-key="parts">Gi·ªè h√†ng</a> 
                            <a href="#" class="menu-item" data-key="settings">C√†i ƒë·∫∑t</a>
                            <button class="menu-item log-out-btn" onclick="logout()" data-key="logout">ƒêƒÉng
                                xu·∫•t</button>
                        </div>
                    </div>
                    <div class="vr mx-3"></div>

                    <div class="btn-group btn-group-sm me-2" role="group">
                        <button type="button" class="btn btn-outline-secondary lang-btn" data-lang="vi">VI</button>
                        <button type="button" class="btn btn-outline-secondary lang-btn" data-lang="en">EN</button>
                    </div>

                    <button class="btn" id="theme-switcher-btn">
                        <i class="fas fa-moon" id="theme-icon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>
    <main class="container py-5">
        <h1 class="mb-4" data-key="cart_main_title">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h1>

        <div class="row">
            <div class="col-lg-8">
                <div id="cart-items-container" class="cart-items-container">
                    <p id="empty-cart-message" class="alert alert-info text-center" data-key="cart_empty_message" style="display: none;">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng. H√£y th√™m s·∫£n ph·∫©m nh√©!</p>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="cart-summary p-4 border rounded shadow-sm sticky-lg-top">
                    <h3 data-key="cart_summary_title">T√≥m t·∫Øt ƒë∆°n h√†ng</h3>
                    <hr>
                    <div class="d-flex justify-content-between mb-3">
                        <span data-key="cart_subtotal">T·ªïng ph·ª•:</span>
                        <span id="subtotal">0 ƒë</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span data-key="cart_shipping">Ph√≠ v·∫≠n chuy·ªÉn:</span>
                        <span>Mi·ªÖn ph√≠</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between fw-bold fs-5 mb-4">
                        <span data-key="cart_total">T·ªïng c·ªông:</span>
                        <span id="total-amount" class="text-danger">0 ƒë</span>
                    </div>
                    <button class="btn btn-primary w-100 btn-lg" data-key="cart_checkout_btn">Ti·∫øn h√†nh thanh to√°n</button>
                    <a href="collection.html" class="btn btn-outline-secondary w-100 mt-2" data-key="cart_continue_shopping">Ti·∫øp t·ª•c mua h√†ng</a>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>¬© 2025 GearVN Store ‚Äî All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="Scripts/main.js"></script>
    <script>
        // --- LOGIC HI·ªÇN TH·ªä GI·ªé H√ÄNG TR√äN cart.html ---

        document.addEventListener('DOMContentLoaded', () => {
            // Ki·ªÉm tra xem h√†m c√≥ ƒë∆∞·ª£c export t·ª´ main.js kh√¥ng
            if (typeof window.getCart !== 'function' || typeof window.saveCart !== 'function') {
                console.error("L·ªói: C√°c h√†m Gi·ªè h√†ng (getCart, saveCart) ch∆∞a ƒë∆∞·ª£c t·∫£i t·ª´ main.js. H√£y ki·ªÉm tra l·∫°i file main.js.");
                return;
            }

            const cartContainer = document.getElementById('cart-items-container');
            const emptyMessage = document.getElementById('empty-cart-message');
            const subtotalEl = document.getElementById('subtotal');
            const totalAmountEl = document.getElementById('total-amount');

            // H√†m format ti·ªÅn t·ªá
            const formatCurrency = (amount) => {
                return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
            };

            // H√†m t√≠nh v√† hi·ªÉn th·ªã t·ªïng ti·ªÅn
            const updateSummary = (cart) => {
                const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                
                subtotalEl.textContent = formatCurrency(subtotal);
                totalAmountEl.textContent = formatCurrency(subtotal);
            };

            // H√†m X√≥a s·∫£n ph·∫©m (ƒê∆∞·ª£c g√°n v√†o window ƒë·ªÉ d√πng trong onclick)
            window.removeFromCart = function(productId) {
                let cart = window.getCart();
                const newCart = cart.filter(item => item.id != productId); 
                window.saveCart(newCart);
                renderCart(); // V·∫Ω l·∫°i giao di·ªán
            }

            // H√†m C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng (ƒê∆∞·ª£c g√°n v√†o window ƒë·ªÉ d√πng trong onclick)
            window.updateQuantity = function(productId, change) {
                let cart = window.getCart();
                const productIndex = cart.findIndex(item => item.id == productId);

                if (productIndex > -1) {
                    cart[productIndex].quantity += change;
                    if (cart[productIndex].quantity <= 0) {
                        // N·∫øu s·ªë l∆∞·ª£ng <= 0, x√≥a s·∫£n ph·∫©m
                        window.removeFromCart(productId);
                        return;
                    }
                    window.saveCart(cart);
                    renderCart(); // V·∫Ω l·∫°i giao di·ªán
                }
            }


            // H√†m ch√≠nh ƒë·ªÉ v·∫Ω l·∫°i giao di·ªán Gi·ªè h√†ng
            function renderCart() {
                const cart = window.getCart();
                cartContainer.innerHTML = ''; 

                if (cart.length === 0) {
                    emptyMessage.style.display = 'block';
                    updateSummary([]); // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn v·ªÅ 0
                } else {
                    emptyMessage.style.display = 'none';
                    
                    cart.forEach(item => {
                        const itemTotal = item.price * item.quantity;
                        const cartItemHtml = `
                            <div class="cart-item d-flex align-items-center mb-3 p-3 border rounded">
                                <img src="${item.image}" alt="${item.name}" class="img-fluid me-3" loading="lazy">
                                <div class="flex-grow-1">
                                    <h5>${item.name}</h5>
                                    <p class="text-muted mb-1">${formatCurrency(item.price)} / s·∫£n ph·∫©m</p>
                                    <div class="d-flex align-items-center">
                                        <button class="btn btn-sm btn-outline-secondary me-2" onclick="updateQuantity(${item.id}, -1)">-</button>
                                        <span class="quantity-display me-2">${item.quantity}</span>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="updateQuantity(${item.id}, 1)">+</button>
                                    </div>
                                </div>
                                <div class="text-end ms-3">
                                    <p class="mb-1 fw-bold text-danger item-total">${formatCurrency(itemTotal)}</p>
                                    <button class="btn btn-sm btn-link text-danger p-0" onclick="removeFromCart(${item.id})">
                                        <i class="fas fa-trash-alt"></i> X√≥a
                                    </button>
                                </div>
                            </div>
                        `;
                        cartContainer.innerHTML += cartItemHtml;
                    });
                    
                    updateSummary(cart);
                }
                
                window.updateCartCount(); 
            }

            renderCart(); // G·ªçi h√†m ƒë·ªÉ hi·ªÉn th·ªã gi·ªè h√†ng khi t·∫£i trang
        });
    </script>
</body>
</html>